@using Aurorae.Models.Gallery
@using Humanizer
@inject ImageSourceProvider ImageSourceProvider
@model FileViewModel
@{
    ViewData["Title"] = $"图库 - {Model.FileInfo.Name}";
    ViewData["Header"] = $"图库/{Model.ItemPath}";
    var file = Model.FileInfo;
    var (prev, parent, next) = Model.GetNeighbors();
    var source = ImageSourceProvider.GetSource(Model.FileInfo);
}

<h1>@ViewData["Header"]</h1>

<div class="file-nav list-group list-group-horizontal-sm mb-2">
    @if (prev != null)
    {
        <a class="list-group-item list-group-item-action" href="/gallery/@prev.ItemPath">
            <i class="bi bi-chevron-left"></i> @prev.FileInfo.Name
        </a>
    }
    @if (parent != null)
    {
        <a class="list-group-item list-group-item-action" href="/gallery/@parent.ItemPath">
            <i class="bi bi-chevron-bar-up"></i> @parent.DirectoryInfo.Name
        </a>
    }
    @if (next != null)
    {
        <a class="list-group-item list-group-item-action" href="/gallery/@next.ItemPath">
            <i class="bi bi-chevron-right"></i> @next.FileInfo.Name
        </a>
    }
</div>

<p>
    <span class="badge text-bg-info">@file.Length.Bytes().Humanize()</span>
    <span class="badge text-bg-secondary">@file.LastWriteTime.ToString("f")</span>
    <span class="badge text-bg-secondary">@file.LastWriteTime.Humanize()</span>
    @if (source != null)
    {
        <a href="@source.Url"><span class="badge text-bg-success">@source.Type</span></a>
    }
</p>

@if (Model.IsImage)
{
    <img src="/resources/images/@Model.ItemPath" id="image" class="zoomable" />
}
@if (Model.IsText)
{
    <div id="text"></div>
}

@section Scripts {
    <script>window.ItemPath = @Json.Serialize(Model.ItemPath)</script>
    @if (Model.IsImage)
    {
        <script src="~/lib/medium-zoom/medium-zoom.min.js"></script>
        <script>mediumZoom('.zoomable')</script>
    }
    @if (Model.IsText)
    {
        <script>
            fetch(`/resources/text/${window.ItemPath}`)
                .then(r => r.text())
                .then(t => document.getElementById('text').innerText = t);
        </script>
    }
}